# 🚀 開始測試推送通知

## ✅ Expo 開發模式已啟動

Metro Bundler 正在運行：http://localhost:8081

---

## 📱 立即開始（3 步驟）

### 步驟 1：連接設備

在 Expo 終端（Terminal 49）：

**選項 A：使用實體設備**
- 手機上打開 Expo Go App
- 掃描終端中的 QR Code

**選項 B：使用 Android 模擬器**
- 在 Expo 終端按 `a` 鍵

**選項 C：使用已編譯的 App**
- 搖動手機打開開發選單
- 選擇「Settings」→「Development servers」
- 輸入：`http://192.168.1.107:8081`

---

### 步驟 2：登入 App

1. 在 App 中登入（任一測試帳號）
2. **查看日誌**（重要！）

**應該看到**：
```
[authStore] 註冊推送通知...
📢 初始化通知服務...
✅ 通知服務初始化成功
✅ Push Token 已獲取: ExponentPushToken[xxxxxx]
[ApiClient] POST success: /app/push/register
[authStore] ✅ Push Token 已註冊到後端
```

**不會再有 Firebase 錯誤！** ✅

---

### 步驟 3：測試推送通知

#### A. 創建測試警報
```bash
# 在另一個終端執行
pnpm test:alert 4
```

#### B. 在 App 中分配
1. 以管理員身份登入
2. 進入「緊急通知」→「所有警報」
3. 找到測試警報（🧪 緊急求助）
4. 點擊進入詳情
5. 點擊「分配警報」
6. 選擇 1-2 位成員
7. 確認分配

#### C. 檢查通知
- **前景**：App 開啟時，頂部顯示通知橫幅
- **背景**：按 Home 鍵，通知中心顯示
- **關閉**：完全關閉 App，收到系統通知

---

## 🔍 驗證推送通知成功

### 檢查 1：App 日誌
```
✅ Push Token 已獲取: ExponentPushToken[...]
✅ Push Token 已註冊到後端
```

### 檢查 2：資料庫
```bash
pnpm db:studio
```
查看 `push_tokens` 表，應該有記錄。

### 檢查 3：後端日誌
分配警報時應該看到：
```
[PushNotificationsService] Sending push notification to 2 devices
[PushNotificationsService] Sent 2 notifications
[PushNotificationsService] Push notification results: 2 success, 0 errors
```

### 檢查 4：收到通知
- ✅ 手機顯示通知
- ✅ 有聲音和震動
- ✅ 點擊可以打開 App

---

## 🎯 測試場景

### 場景 1：前景通知
1. App 保持開啟
2. 分配警報
3. ✅ 頂部出現通知橫幅

### 場景 2：背景通知
1. 按 Home 鍵（App 在背景）
2. 分配警報
3. ✅ 通知中心顯示通知
4. 點擊通知打開 App

### 場景 3：離線通知（最重要）
1. 完全關閉 App（從最近使用中滑掉）
2. 分配警報
3. ✅ 收到系統通知
4. 點擊通知啟動 App

---

## 💡 Expo 開發模式的優勢

### 推送通知
- ✅ 自動可用
- ✅ 無需 Firebase
- ✅ 支援所有狀態（前景、背景、關閉）

### 開發體驗
- ⚡ 快速重新載入
- 🔄 熱更新
- 🐛 即時錯誤顯示

### 跨平台
- 📱 Android 和 iOS 同一套代碼
- 🌐 甚至可以在 Web 上運行（按 `w`）

---

## 🔧 常用命令

在 Expo 終端中：

| 按鍵 | 功能 |
|------|------|
| `a` | 在 Android 運行 |
| `i` | 在 iOS 運行 |
| `w` | 在 Web 運行 |
| `r` | 重新載入 App |
| `m` | 顯示開發選單 |
| `c` | 清除快取 |
| `?` | 顯示所有命令 |

---

## 🎊 完成！

現在您的開發環境已經是**標準配置**：

✅ **Expo 開發模式** - 快速迭代  
✅ **推送通知可用** - 無需配置  
✅ **熱更新支援** - 即時預覽  
✅ **跨平台測試** - 一次開發  

---

## 📚 下一步

1. **連接設備**（Expo Go 或模擬器）
2. **登入 App**（查看 Token 註冊日誌）
3. **測試推送通知**（分配警報）
4. **驗證所有功能**（接受、婉拒、重新分配）

---

## 🆘 需要幫助？

### 如果連接失敗
- 確保手機和電腦在同一 WiFi
- 執行 `pnpm show-ip` 查看 IP
- 在 Expo Go 中手動輸入 URL

### 如果還是有錯誤
- 查看 Expo 終端的錯誤訊息
- 查看 App 日誌
- 告訴我具體的錯誤

---

**開始測試推送通知吧！** 🎉

現在應該完全正常運作了！
