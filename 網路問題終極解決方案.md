# 🎯 網路問題終極解決方案

## 問題現象

> 為什麼換 WiFi 或網路，前端就抓不到後端資料了？

---

## ⚡ 立即解決（30 秒）

### 1️⃣ 執行自動修復

```bash
pnpm update-ip
```

### 2️⃣ 重啟前端

```bash
# Admin 前端（如果在運行）
# 按 Ctrl+C 停止，然後重新啟動
cd apps/admin && pnpm dev

# Mobile App（如果在運行）
# 按 Ctrl+C 停止，然後重新啟動
cd apps/mobile && pnpm android
```

### ✅ 完成！

---

## 🔍 深入理解

### 為什麼會發生這個問題？

您的配置文件使用了**硬編碼的 IP 地址**：

```typescript
// apps/admin/.env
VITE_API_URL=http://192.168.1.100:3001/api  ← 舊 IP

// apps/mobile/src/config.local.ts
export const API_BASE_URL = 'http://192.168.1.100:3001/api';  ← 舊 IP
```

當您切換 WiFi 後：
- 家裡 WiFi：電腦 IP = `192.168.1.100` ✅
- 公司 WiFi：電腦 IP = `10.0.5.50` ❌
- 咖啡廳：電腦 IP = `172.16.8.20` ❌

配置還是指向 `192.168.1.100`，所以連不上！

---

## 🛠️ 已為您準備的工具

我已經創建了以下工具來解決這個問題：

### 1. 自動 IP 更新工具

```bash
pnpm update-ip
```

**功能**：
- ✅ 自動檢測您當前的局域網 IP
- ✅ 更新 Admin 前端配置
- ✅ 更新 Mobile App 配置
- ✅ 顯示更新結果

**使用時機**：
- 每次切換 WiFi 後
- 每天開始工作前
- 發現連不上後端時

---

### 2. 網路資訊查看工具

```bash
pnpm show-ip
```

**功能**：
- 📍 顯示當前 IP 地址
- 📋 顯示當前配置
- 🔗 顯示所有可用的 API 地址
- 💡 提供操作建議

---

### 3. 後端連接檢測工具

```bash
pnpm check-backend
```

**功能**：
- 🧪 測試後端是否運行
- 🔍 檢查配置是否正確
- 💡 提供修復建議

---

## 📚 解決方案比較

### 方案 A：自動 IP 腳本（當前方案）⭐

**適合**：頻繁切換網路的開發環境

✅ **優點**：
- 一個命令解決問題
- 自動更新所有配置
- 不需要手動查 IP

⚠️ **限制**：
- 切換網路後需要執行一次
- 需要重啟前端服務

**使用**：
```bash
# 切換 WiFi 後
pnpm update-ip

# 重啟前端（如果在運行）
```

---

### 方案 B：使用 mDNS (.local 域名)

**適合**：macOS/iOS 開發，不想每次都執行命令

✅ **優點**：
- 切換網路後無需修改配置
- 使用電腦名稱，不用記 IP

⚠️ **限制**：
- Android 可能不支援
- 需要電腦名稱沒有空格

**設定**：

1. 查看您的電腦名稱：
```bash
hostname
# 例如輸出：MacBook-Pro
```

2. 修改配置：
```typescript
// apps/admin/.env
VITE_API_URL=http://MacBook-Pro.local:3001/api

// apps/mobile/src/config.local.ts
export const API_BASE_URL = 'http://MacBook-Pro.local:3001/api';
```

3. 重啟前端，完成！

---

### 方案 C：部署後端到雲端（終極方案）🚀

**適合**：
- 需要多人協作
- 需要遠程測試
- 不想再處理網路問題

✅ **優點**：
- 一勞永逸
- 任何網路都能訪問
- 穩定可靠

⚠️ **考量**：
- 需要雲端服務（多數有免費額度）
- 需要設定資料庫

**最簡單的部署方式**：

#### 使用 Railway（5 分鐘）

```bash
# 1. 安裝 CLI
npm install -g @railway/cli

# 2. 登入
cd apps/backend
railway login

# 3. 部署
railway init
railway up

# 4. 獲取 URL（例如：https://your-app.railway.app）

# 5. 更新前端配置
# apps/admin/.env
VITE_API_URL=https://your-app.railway.app/api

# apps/mobile/src/config.local.ts
export const API_BASE_URL = 'https://your-app.railway.app/api';
```

完成！現在換任何網路都不用擔心了。

**費用**：Railway 每月提供 $5 免費額度，足夠開發使用。

詳細部署指南：查看 `DEPLOY_GUIDE.md`

---

## 🎯 我的建議

根據您的情況選擇：

### 如果您經常在不同地方工作（咖啡廳、家裡、公司）

**短期**：使用方案 A（自動 IP 腳本）
```bash
# 每次切換網路後執行
pnpm update-ip
```

**長期**：部署到 Railway
```bash
# 一次設定，永久解決
railway up
```

---

### 如果您主要在固定地點開發

**使用方案 B（mDNS）**
- 設定一次，不用再管
- 切換網路也不影響（只要是同一台電腦）

---

## 📋 快速命令參考

```bash
# 🔄 更新 IP 配置（切換網路後使用）
pnpm update-ip

# 📊 查看網路資訊和當前配置
pnpm show-ip

# 🧪 檢測後端連接狀態
pnpm check-backend

# 🚀 啟動後端
cd apps/backend && pnpm dev

# 💻 啟動 Admin 前端
cd apps/admin && pnpm dev

# 📱 啟動 Mobile App
cd apps/mobile && pnpm android
```

---

## 🐛 常見問題

### Q: 執行 `pnpm update-ip` 後還是連不上？

**A: 檢查以下幾點：**

1. 後端是否在運行？
```bash
pnpm check-backend
```

2. 是否重啟了前端？
```bash
# Admin 需要按 Ctrl+C 停止並重新啟動
cd apps/admin && pnpm dev

# Mobile App 也需要重新啟動
cd apps/mobile && pnpm android
```

3. 防火牆是否阻擋？
- macOS: 系統偏好設定 → 安全性與隱私 → 防火牆
- 確保允許 Node.js 接受連接

---

### Q: Android 實體設備連不上？

**A: 確保：**
1. 手機和電腦在**同一個 WiFi**
2. 使用電腦的局域網 IP（不是 localhost）
3. 執行 `pnpm update-ip` 後重新編譯 App

---

### Q: 每次都要執行 `pnpm update-ip` 太麻煩？

**A: 有兩個更好的方案：**

1. **使用 mDNS**（如上方案 B）
   - 一次設定，不用再管

2. **部署到雲端**（如上方案 C）
   - 永久解決，任何網路都能用

---

## 📈 效果對比

### 使用前（痛苦）：
1. 切換 WiFi 😫
2. 前端連不上 😭
3. Google 搜尋問題 🔍
4. 手動查 IP：`ifconfig` 😓
5. 手動改配置文件 ✏️
6. 重啟前端 🔄
7. 還是不行，繼續排查... 😤

**總耗時：10-30 分鐘**

---

### 使用後（輕鬆）：
1. 切換 WiFi 😊
2. 執行：`pnpm update-ip` ⚡
3. 重啟前端 🔄
4. 完成！✅

**總耗時：30 秒**

---

### 部署到雲端後（完美）：
1. 切換 WiFi 😊
2. 繼續工作 ✅

**總耗時：0 秒**

---

## 🎓 最佳實踐

### 開發環境

```bash
# 每天開始工作前執行一次
pnpm update-ip

# 或者在啟動腳本中加入檢查
# 可以在 package.json 中設定：
"start": "pnpm update-ip && pnpm dev"
```

---

### 生產環境

**一定要部署到雲端**，不要依賴本地網路！

推薦順序：
1. Railway（最簡單）
2. Render（免費但有限制）
3. Fly.io（效能好）

---

## 🆘 還是有問題？

### 運行完整診斷

```bash
# 1. 查看網路資訊
pnpm show-ip

# 2. 檢查後端
pnpm check-backend

# 3. 測試 API
curl http://localhost:3001/api/health

# 4. 查看後端日誌
cd apps/backend
pnpm dev
# 觀察啟動輸出
```

### 提供這些資訊：
- 執行 `pnpm show-ip` 的輸出
- 執行 `pnpm check-backend` 的輸出
- 後端啟動的日誌
- 前端的錯誤訊息（按 F12 查看 Console）

---

## ✨ 總結

您現在有**三套完整的解決方案**：

1. **方案 A**：自動 IP 腳本（`pnpm update-ip`）
   - 適合：開發環境，頻繁切換網路

2. **方案 B**：mDNS 域名（`.local`）
   - 適合：macOS/iOS 開發，固定設備

3. **方案 C**：雲端部署（Railway 等）
   - 適合：生產環境，團隊協作

**我的建議**：
- 現在立即使用方案 A 解決當前問題
- 週末時部署到 Railway（方案 C），徹底解決

---

**不要再為網路問題煩惱了！** 🎉

有任何問題隨時問我！
