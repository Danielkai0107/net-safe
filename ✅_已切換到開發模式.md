# ✅ 已切換到 Expo 開發模式

## 🎉 完成！

Expo 開發伺服器已啟動，正在運行在：
- **Metro Bundler**: http://localhost:8081

---

## 📱 下一步：連接您的設備

### 方法 1：使用實體設備（推薦）⭐

#### 如果已安裝 Expo Go：
1. 打開 Expo Go App
2. 掃描終端中的 QR Code
3. 或在同一 WiFi 下自動連接

#### 如果還沒安裝 Expo Go：
1. 下載 Expo Go App：
   - Android: Google Play Store
   - iOS: App Store
2. 打開後掃描 QR Code

---

### 方法 2：使用 Android 模擬器

在 Expo 終端按 `a` 鍵，會自動在模擬器中打開。

---

### 方法 3：使用已編譯的 App

如果您的實體設備上已經有編譯好的 App：

在 Expo 終端按 `s` 切換到開發模式，然後：
1. 搖動手機
2. 選擇「Settings」
3. 選擇「Development servers」
4. 輸入：`http://YOUR_IP:8081`（使用 `pnpm show-ip` 查看 IP）

---

## 🔍 檢查 Expo 狀態

### 查看終端輸出

應該看到類似：
```
Starting project at /Users/danielkai/Desktop/safe-net/apps/mobile
Starting Metro Bundler
Waiting on http://localhost:8081

› Metro waiting on exp://192.168.1.107:8081
› Scan the QR code above with Expo Go (Android) or the Camera app (iOS)

› Press a │ open Android
› Press i │ open iOS simulator
› Press w │ open web

› Press r │ reload app
› Press m │ toggle menu
› Press o │ open project code in your editor
```

---

## ✅ 現在推送通知會正常運作

### 為什麼？

**開發模式下**：
- ✅ Expo 自動處理推送通知
- ✅ 無需 Firebase 配置
- ✅ `getExpoPushTokenAsync()` 會成功
- ✅ 後端可以發送推送通知
- ✅ 離開 App 也能收到

---

## 🧪 測試推送通知

### 1. 連接設備後，登入 App

查看日誌應該會看到：
```
[authStore] 註冊推送通知...
📢 初始化通知服務...
✅ 通知服務初始化成功
✅ Push Token 已獲取: ExponentPushToken[xxxxxx]
[authStore] ✅ Push Token 已註冊到後端
```

**不會再有 Firebase 錯誤！** ✅

---

### 2. 驗證 Token 已註冊

```bash
pnpm db:studio
```

查看 `push_tokens` 表，應該有新記錄。

---

### 3. 創建測試警報

```bash
pnpm test:alert 4
```

---

### 4. 在 App 中分配警報

1. 以管理員登入
2. 進入「緊急通知」→「所有警報」
3. 找到測試警報
4. 點擊「分配警報」
5. 選擇成員
6. 確認分配

---

### 5. 檢查推送通知

#### 前景測試（App 開啟）
- ✅ 頂部出現通知橫幅
- ✅ 有聲音和震動

#### 背景測試（App 在背景）
1. 按 Home 鍵將 App 切到背景
2. 分配新警報
3. ✅ 通知中心顯示通知

#### 離線測試（App 關閉）
1. 從最近使用的 App 中滑掉 Safe-Net
2. 分配新警報
3. ✅ 收到系統通知
4. 點擊通知啟動 App

---

## 🎯 關鍵差異

### 之前（expo run:android）
```
編譯原生代碼
  ↓
需要 Firebase 配置 ❌
  ↓
getExpoPushTokenAsync() 失敗
  ↓
無法收到推送通知
```

### 現在（expo start）
```
Expo 開發模式
  ↓
Expo 自動處理推送 ✅
  ↓
getExpoPushTokenAsync() 成功
  ↓
可以收到推送通知 ✅
```

---

## 📊 開發模式 vs 編譯模式

| 特性 | expo start | expo run:android |
|------|-----------|------------------|
| 啟動速度 | ⚡ 快（幾秒） | 🐢 慢（幾分鐘） |
| 推送通知 | ✅ 自動可用 | ⚠️ 需配置 Firebase |
| 熱更新 | ✅ 支援 | ✅ 支援 |
| 原生模組 | ⚠️ 部分支援 | ✅ 完全支援 |
| 適合階段 | 開發測試 | 發布前測試 |

---

## 💡 開發建議

### 日常開發（90% 時間）
使用 `expo start`：
```bash
cd apps/mobile
npx expo start
```

### 測試原生功能時
使用 `expo run:android`：
```bash
# 需要時才編譯
npx expo run:android
```

### 發布前
配置 Firebase 和 APNs，使用 EAS Build

---

## 🎊 完成！

Expo 開發模式已啟動！

**現在請：**
1. 在手機上打開 Expo Go（或按 `a` 在模擬器運行）
2. 連接到開發伺服器
3. 登入 App
4. 測試推送通知

**推送通知現在應該完全正常運作了！** 🚀

---

## 🆘 如果需要幫助

### 查看 Expo 終端
- 按 `?` 查看所有命令
- 按 `r` 重新載入
- 按 `a` 在 Android 運行
- 按 `i` 在 iOS 運行

### 常見問題
- 如果看不到 QR Code：按 `Shift+M` 顯示
- 如果連接失敗：確保手機和電腦在同一 WiFi
- 如果需要重啟：按 `Ctrl+C` 停止，重新執行 `npx expo start`

---

**開始測試吧！** 🎉
